{% extends "base.html" %}

{% block title %}Detail Dataset - {{ dataset.name }}{% endblock title %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <!-- Header -->
            <div class="card mb-4">
                <div class="card-header pb-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6>Detail Dataset: {{ dataset.name }}</h6>
                            <p class="text-sm mb-0">Informasi lengkap tentang dataset dan data yang terkandung di dalamnya</p>
                        </div>
                        <div>
                            <a href="{{ url_for('dataset_management_table') }}" class="btn btn-sm btn-outline-secondary">
                                <i class="fas fa-arrow-left"></i> Kembali
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dataset Info -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header pb-0">
                            <h6>Informasi Dataset</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-sm-4">
                                    <p class="mb-0 text-sm font-weight-bold">Nama:</p>
                                </div>
                                <div class="col-sm-8">
                                    <p class="text-muted mb-0 text-sm">{{ dataset.name }}</p>
                                </div>
                            </div>
                            <hr class="horizontal gray-light my-2">
                            <div class="row">
                                <div class="col-sm-4">
                                    <p class="mb-0 text-sm font-weight-bold">Dibuat:</p>
                                </div>
                                <div class="col-sm-8">
                                    <p class="text-muted mb-0 text-sm">{{ dataset.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
                                </div>
                            </div>
                            <hr class="horizontal gray-light my-2">
                            <div class="row">
                                <div class="col-sm-4">
                                    <p class="mb-0 text-sm font-weight-bold">Diperbarui:</p>
                                </div>
                                <div class="col-sm-8">
                                    <p class="text-muted mb-0 text-sm">{{ dataset.updated_at.strftime('%d/%m/%Y %H:%M') }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header pb-0">
                            <h6>Statistik Data</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-6">
                                    <div class="text-center">
                                        <h4 class="font-weight-bolder">{{ raw_upload_data|length + raw_scraper_data|length }}</h4>
                                        <p class="mb-0 text-sm">Total Data Mentah</p>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center">
                                        <h4 class="font-weight-bolder text-success">{{ clean_upload_data|length + clean_scraper_data|length }}</h4>
                                        <p class="mb-0 text-sm">Data Bersih</p>
                                    </div>
                                </div>
                            </div>
                            <hr class="horizontal gray-light my-3">
                            <div class="row">
                                <div class="col-6">
                                    <div class="text-center">
                                        <h4 class="font-weight-bolder text-info">{{ classified_upload_data|length + classified_scraper_data|length }}</h4>
                                        <p class="mb-0 text-sm">Terklasifikasi</p>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center">
                                        {% set total_raw_data = raw_upload_data|length + raw_scraper_data|length %}
                                        {% set clean_data = clean_upload_data|length + clean_scraper_data|length %}
                                        {% set classified_data = classified_upload_data|length + classified_scraper_data|length %}
                                        {% set raw_unprocessed = raw_upload_data|selectattr('status', 'equalto', 'raw')|list|length + raw_scraper_data|selectattr('status', 'equalto', 'raw')|list|length %}
                                        {% if classified_data > 0 %}
                                            <span class="badge badge-lg bg-gradient-primary">Terklasifikasi</span>
                                        {% elif clean_data > 0 %}
                                            <span class="badge badge-lg bg-gradient-success">Dibersihkan</span>
                                        {% else %}
                                            <span class="badge badge-lg bg-gradient-secondary">Mentah</span>
                                        {% endif %}
                                        <p class="mb-0 text-sm mt-2">Status Dataset</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Data Tables -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header pb-0">
                            <ul class="nav nav-tabs" id="dataTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="raw-tab" data-toggle="tab" data-target="#raw" type="button" role="tab" aria-controls="raw" aria-selected="true">
                                        <i class="fas fa-database mr-2"></i>Data Mentah ({{ raw_upload_data|length + raw_scraper_data|length }})
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="clean-tab" data-toggle="tab" data-target="#clean" type="button" role="tab" aria-controls="clean" aria-selected="false">
                                        <i class="fas fa-broom mr-2"></i>Data Bersih ({{ clean_upload_data|length + clean_scraper_data|length }})
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="classified-tab" data-toggle="tab" data-target="#classified" type="button" role="tab" aria-controls="classified" aria-selected="false">
                                        <i class="fas fa-tags mr-2"></i>Hasil Klasifikasi ({{ classified_upload_data|length + classified_scraper_data|length }})
                                    </button>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content" id="dataTabContent">
                                <!-- Raw Data Tab -->
                                <div class="tab-pane fade show active" id="raw" role="tabpanel" aria-labelledby="raw-tab">
                                    <div class="table-responsive">
                                        <table class="table align-items-center mb-0">
                                            <thead>
                                                <tr>
                                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">ID</th>
                                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Username</th>
                                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">URL</th>
                                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Konten</th>
                                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Sumber</th>
                                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Tanggal</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for data in raw_upload_data %}
                                                <tr>
                                                    <td class="text-sm">{{ data.id }}</td>
                                                    <td class="text-sm">{{ data.username if data.username else '-' }}</td>
                                                    <td class="text-sm">{{ data.url[:50] if data.url else '-' }}{% if data.url and data.url|length > 50 %}...{% endif %}</td>
                                                    <td class="text-sm">{{ data.content[:100] }}{% if data.content|length > 100 %}...{% endif %}</td>
                                                    <td><span class="badge badge-sm bg-gradient-info">Upload</span></td>
                                                    <td class="text-sm">{{ data.created_at.strftime('%d/%m/%Y %H:%M') if data.created_at else '-' }}</td>
                                                </tr>
                                                {% endfor %}
                                                {% for data in raw_scraper_data %}
                                                <tr>
                                                    <td class="text-sm">{{ data.id }}</td>
                                                    <td class="text-sm">{{ data.username if data.username else '-' }}</td>
                                                    <td class="text-sm">{{ data.url[:50] if data.url else '-' }}{% if data.url and data.url|length > 50 %}...{% endif %}</td>
                                                    <td class="text-sm">{{ data.content[:100] }}{% if data.content|length > 100 %}...{% endif %}</td>
                                                    <td><span class="badge badge-sm bg-gradient-warning">Scraping</span></td>
                                                    <td class="text-sm">{{ data.created_at.strftime('%d/%m/%Y %H:%M') if data.created_at else '-' }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <!-- Clean Data Tab -->
                                <div class="tab-pane fade" id="clean" role="tabpanel" aria-labelledby="clean-tab">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Username</th>
                                                    <th>URL</th>
                                                    <th>Konten Bersih</th>
                                                    <th>Sumber</th>
                                                    <th>Tanggal</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for data in clean_upload_data %}
                                                <tr>
                                                    <td>{{ data.id }}</td>
                                                    <td>{{ data.username }}</td>
                                                    <td>{{ data.url or '-' }}</td>
                                                    <td>{{ data.cleaned_content[:100] }}...</td>
                                                    <td><span class="badge bg-primary">Upload</span></td>
                                                    <td>{{ data.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                                                </tr>
                                                {% endfor %}
                                                {% for data in clean_scraper_data %}
                                                <tr>
                                                    <td>{{ data.id }}</td>
                                                    <td>{{ data.username }}</td>
                                                    <td>{{ data.url or '-' }}</td>
                                                    <td>{{ data.cleaned_content[:100] }}...</td>
                                                    <td><span class="badge bg-success">Scraping</span></td>
                                                    <td>{{ data.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <!-- Classification Results Tab -->
                                <div class="tab-pane fade" id="classified" role="tabpanel" aria-labelledby="classified-tab">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Username</th>
                                                    <th>Konten</th>
                                                    <th>URL</th>
                                                    <th>Tipe Data</th>
                                                    <th>Model 1</th>
                                                    <th>Model 2</th>
                                                    <th>Model 3</th>
                                                    <th>Tanggal</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for data in classified_upload_data %}
                                                <tr>
                                                    <td>{{ data.id }}</td>
                                                    <td>{{ data.username or '-' }}</td>
                                                    <td>{{ data.content[:100] }}...</td>
                                                    <td>{{ data.url or '-' }}</td>
                                                    <td><span class="badge bg-primary">Upload</span></td>
                                                    <td>
                                                        {% if data.prediction == 'radikal' %}
                                                            <span class="badge bg-danger">Radikal</span>
                                                        {% else %}
                                                            <span class="badge bg-success">Non-Radikal</span>
                                                        {% endif %}
                                                        <br><small>{{ "%.2f"|format(data.probability_radikal * 100) }}%</small>
                                                    </td>
                                                    <td>
                                                        {% if data.prediction == 'radikal' %}
                                                            <span class="badge bg-danger">Radikal</span>
                                                        {% else %}
                                                            <span class="badge bg-success">Non-Radikal</span>
                                                        {% endif %}
                                                        <br><small>{{ "%.2f"|format(data.probability_radikal * 100) }}%</small>
                                                    </td>
                                                    <td>
                                                        {% if data.prediction == 'radikal' %}
                                                            <span class="badge bg-danger">Radikal</span>
                                                        {% else %}
                                                            <span class="badge bg-success">Non-Radikal</span>
                                                        {% endif %}
                                                        <br><small>{{ "%.2f"|format(data.probability_radikal * 100) }}%</small>
                                                    </td>
                                                    <td>{{ data.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                                                </tr>
                                                {% endfor %}
                                                {% for data in classified_scraper_data %}
                                                <tr>
                                                    <td>{{ data.id }}</td>
                                                    <td>{{ data.username or '-' }}</td>
                                                    <td>{{ data.content[:100] }}...</td>
                                                    <td>{{ data.url or '-' }}</td>
                                                    <td><span class="badge bg-success">Scraping</span></td>
                                                    <td>
                                                        {% if data.prediction == 'radikal' %}
                                                            <span class="badge bg-danger">Radikal</span>
                                                        {% else %}
                                                            <span class="badge bg-success">Non-Radikal</span>
                                                        {% endif %}
                                                        <br><small>{{ "%.2f"|format(data.probability_radikal * 100) }}%</small>
                                                    </td>
                                                    <td>
                                                        {% if data.prediction == 'radikal' %}
                                                            <span class="badge bg-danger">Radikal</span>
                                                        {% else %}
                                                            <span class="badge bg-success">Non-Radikal</span>
                                                        {% endif %}
                                                        <br><small>{{ "%.2f"|format(data.probability_radikal * 100) }}%</small>
                                                    </td>
                                                    <td>
                                                        {% if data.prediction == 'radikal' %}
                                                            <span class="badge bg-danger">Radikal</span>
                                                        {% else %}
                                                            <span class="badge bg-success">Non-Radikal</span>
                                                        {% endif %}
                                                        <br><small>{{ "%.2f"|format(data.probability_radikal * 100) }}%</small>
                                                    </td>
                                                    <td>{{ data.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Initialize Bootstrap 4 tabs
    $('[data-toggle="tab"]').on('click', function (e) {
        e.preventDefault();
        $(this).tab('show');
    });
});
</script>
{% endblock extra_js %}